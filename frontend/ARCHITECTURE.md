## Functions

- `RootLayout` in `app/layout.tsx` applies Inter font, metadata, and wraps all routes into `AppShell`.
- `AppShell` in `components/layout/app-shell.tsx` composes `Sidebar`, `Header`, and `BottomNav`, maps route titles, and runs GSAP entry animations on navigation.
- `Sidebar` in `components/layout/sidebar.tsx` renders desktop navigation with active-state highlighting and collapse/expand behavior.
- `BottomNav` in `components/layout/bottom-nav.tsx` renders fixed mobile navigation with icon + label tabs.
- `Header` in `components/layout/header.tsx` displays the current page title and action slot with `NotificationBell`.
- `NotificationBell` in `components/layout/notification-bell.tsx` polls `/api/v1/reminders/pending` every 60 seconds and renders a dropdown with pending reminders.

## Types

- `NavigationItem` in `components/layout/navigation-config.ts` defines typed navigation records (route, label, icon component).
- `ReminderItem` and `PendingRemindersResponse` in `components/layout/notification-bell.tsx` define reminder payload structures for polling UI.
- `pageTitles` in `components/layout/navigation-config.ts` centralizes route-to-title mapping used by the header.

## Data Flow

1. Every route is wrapped by `RootLayout` and rendered inside `AppShell`.
2. `AppShell` reads pathname from App Router and passes mapped title to `Header`.
3. `Sidebar` and `BottomNav` reuse `navigationItems` config and compute active items by current pathname.
4. `NotificationBell` fetches pending reminders via `apiClient.get` and refreshes data on a 60-second interval.
5. Route pages (`/`, `/schedule`, `/homework`, `/reminders`, `/analytics`, `/materials`) render section-level content inside the shared shell container.

## Notes

- `next.config.ts` enables `experimental.turbopackUseSystemTlsCerts` to avoid Google Fonts TLS issues in this environment.
- `next.config.ts` also sets `allowedDevOrigins` for `127.0.0.1` used by browser-based integration checks.
- Primary and accent color tokens in `app/globals.css` are shifted to brighter values to match the school-themed UI direction.
- `@tabler/icons-react` is used for all navigation/action icons to align with project icon rules.
- `apiClient.request<T>(endpoint, options)` in `lib/api-client.ts` executes HTTP requests against `NEXT_PUBLIC_API_URL`, normalizes request body/headers, and throws typed API errors.
- `apiClient.get<T>()` and `apiClient.post<T>()` in `lib/api-client.ts` provide typed convenience wrappers.
- `useAppStore` in `store/use-app-store.ts` stores a basic readiness flag for initial Zustand wiring.
- `useScheduleStore` in `store/schedule.ts` loads subjects and lesson slots, handles CRUD for subjects/slots, and tracks loading/error/day selection states.
- `SchedulePageClient` in `components/schedule/schedule-page-client.tsx` coordinates schedule data fetching and modal orchestration for slot/subject management.
- `ScheduleGrid` in `components/schedule/schedule-grid.tsx` renders adaptive schedule views (mobile day tabs + desktop weekday columns).
- `ScheduleForm` in `components/schedule/schedule-form.tsx` validates and submits lesson slots with overlap and time-order checks.
- `SubjectManager` in `components/schedule/subject-manager.tsx` provides subject CRUD UI with color selection.
- `ScheduleSlotCard` in `components/schedule/schedule-slot-card.tsx` displays a lesson slot with subject color marker and edit/delete actions.

## Types

- `ApiRequestOptions` in `types/api.ts` supports generic request bodies for JSON and form payloads.
- `Subject`, `SubjectCreate`, `SubjectUpdate`, `ScheduleSlot`, `ScheduleSlotCreate`, and `ScheduleSlotUpdate` in `types/schedule.ts` define the scheduling domain model.
- `ScheduleStore` in `store/schedule.ts` defines the Zustand contract used by the schedule page.

## Data Flow

1. `app/schedule/page.tsx` renders `SchedulePageClient` as the `/schedule` entry point.
2. On mount, `SchedulePageClient` calls `fetchSubjects()` and `fetchSchedule()` from `useScheduleStore`.
3. `ScheduleGrid` receives subjects/slots from the store and renders either mobile tabs or desktop weekday columns.
4. `ScheduleForm` and `SubjectManager` submit CRUD actions through `useScheduleStore`, which syncs changes back from API endpoints.
5. `ScheduleSlotCard` resolves subject metadata by `subject_id` and exposes edit/delete callbacks.

## Notes

- New schedule API paths are centralized in `store/schedule.ts` as `/subjects` and `/schedule/slots`.
- Subject color rendering uses a constrained palette from `components/schedule/constants.ts` to avoid inline style usage.
- `/schedule` is statically generated by Next.js and becomes interactive client-side through Zustand state.
- `RemindersPage` in `app/reminders/page.tsx` mounts `RemindersPageClient` as the interactive `/reminders` entry point.
- `RemindersPageClient` in `components/reminders/reminders-page-client.tsx` loads reminders/homework from Zustand, maps reminder cards with homework metadata, and coordinates add/edit/delete modal flows.
- `ReminderList` in `components/reminders/reminder-list.tsx` renders grouped reminders by time horizon (`Сегодня`, `Завтра`, `На этой неделе`, `Позднее`).
- `ReminderCard` in `components/reminders/reminder-card.tsx` displays reminder content, status badge (`pending`/`sent`), subject marker, and edit/delete actions.
- `ReminderEditModal` in `components/reminders/reminder-edit-modal.tsx` provides create/update form with datetime validation for future-only reminders.
- `groupReminders`, `sortByClosest`, and `isFutureDate` in `components/reminders/reminder-utils.ts` implement ordering, bucket grouping, and validation helpers used by UI + tests.
- `useReminderStore` in `store/reminders.ts` handles API-backed CRUD operations for reminders and homework options.

## Types

- `ReminderStatus`, `Homework`, `Reminder`, `ReminderCreate`, `ReminderUpdate`, and `ReminderView` in `types/reminders.ts` define the reminders domain and UI projection shape.
- `ReminderStore` in `store/reminders.ts` defines the Zustand contract for loading state, error state, and reminder/homework mutations.
- `ReminderGroup` in `components/reminders/reminder-utils.ts` types grouped reminder sections.

## Data Flow

1. `RemindersPageClient` loads `fetchReminders()` and `fetchHomework()` on mount.
2. Zustand store requests `/api/v1/reminders` and `/api/v1/homework`, then exposes state to UI selectors.
3. Client maps reminders to `ReminderView`, enriches with homework metadata, then sorts/group by helper utilities.
4. `ReminderEditModal` validates datetime and dispatches `addReminder`/`updateReminder`; `ReminderCard` delete action dispatches `deleteReminder`.
5. Store re-fetches reminder list after every mutation to keep UI synchronized with backend state.

## Notes

- Unit/component tests for reminders are implemented with Vitest + Testing Library in `components/reminders/__tests__` and `store/__tests__/reminders.test.ts`.
- Playwright integration coverage for `/reminders` lives in `tests/reminders.spec.ts`; browser execution in this container may require additional system libraries.
- `HomeworkPage` in `app/homework/page.tsx` mounts `HomeworkPageClient` for the `/homework` route.
- `HomeworkPageClient` in `components/homework/homework-page-client.tsx` orchestrates loading homework/subjects, client-side filters, and modal flows for create/edit/mood actions.
- `HomeworkFilters` in `components/homework/homework-filters.tsx` exposes subject/status/deadline selectors and emits normalized filter state.
- `HomeworkList` in `components/homework/homework-list.tsx` renders responsive homework cards and applies GSAP enter animation for card changes.
- `HomeworkCard` in `components/homework/homework-card.tsx` shows subject tag, completion state, overdue highlight, and actions for edit/delete/complexity rating.
- `HomeworkEditModal` in `components/homework/homework-edit-modal.tsx` validates title/deadline and handles add/update payload submission.
- `MoodPicker` in `components/homework/mood-picker.tsx` submits difficulty (`easy`/`normal`/`hard`) with optional note.
- `filterHomework`, `sortByDeadline`, `getStepsProgress`, and `isPastDeadline` in `components/homework/homework-utils.ts` provide filtering/sorting/progress and overdue helpers.
- `useHomeworkStore` in `store/homework.ts` integrates `/api/v1/homework`, `/api/v1/subjects`, and `/api/v1/mood` endpoints through Zustand actions.

## Types

- `Homework`, `HomeworkCreate`, `HomeworkUpdate`, `HomeworkFiltersState`, `Subject`, and `MoodLevel` in `types/homework.ts` define homework domain + filter contracts.
- `HomeworkStore` in `store/homework.ts` defines Zustand state/actions for CRUD, completion toggle, and mood submission.

## Data Flow

1. `/homework` renders `HomeworkPageClient`, which fetches homework and subject dictionaries on mount.
2. Store actions call API endpoints and refresh homework list after create/update/delete/toggle mutations.
3. `HomeworkFilters` updates local filter state; `filterHomework` + `sortByDeadline` derive visible cards.
4. `HomeworkEditModal` and `MoodPicker` submit payloads through store actions and close on success.
5. `HomeworkList` resolves subject metadata per card and animates card set changes with GSAP.

## Notes

- Unit/component TDD coverage for homework is implemented in `store/__tests__/homework.test.ts`, `components/homework/__tests__/homework-edit-modal.test.tsx`, and `components/homework/__tests__/homework-filters.test.tsx`.
- Playwright smoke scenario for `/homework` lives in `tests/homework.spec.ts`.

## Notes (Update: modal overlay + mock API)

- `components/common/modal-overlay.tsx` introduces a shared portal-based modal wrapper with body scroll lock, Escape close handling, focus-first behavior, and GSAP open/close transitions.
- `HomeworkEditModal`, `ReminderEditModal`, `MoodPicker`, `ScheduleForm`, and `SubjectManager` now render modal content through `ModalOverlay`, so dimming covers the full viewport beyond `AppShell` rounded containers.
- `components/layout/app-shell.tsx` uses `min-h-dvh`, and `components/layout/bottom-nav.tsx` raises mobile nav stacking to `z-50` for improved visibility during mobile browser viewport changes.
- `components/schedule/schedule-page-client.tsx` and `components/schedule/schedule-grid.tsx` apply tighter mobile spacing, responsive headline sizing, and a 5-column day selector grid for compact screens.
- `lib/mock-data.ts`, `lib/mock-api-routes.ts`, and `lib/mock-api-client.ts` provide in-memory mock payloads and CRUD behavior for subjects, schedule, homework, reminders, analytics, and pending reminder polling.
- `lib/api-client.ts` exports `api`, switching between `apiClient` and `mockApiClient` via `NEXT_PUBLIC_USE_MOCK`.
- `store/schedule.ts`, `store/homework.ts`, `store/reminders.ts`, `store/analytics.ts`, and `components/layout/notification-bell.tsx` consume `api` to support both live backend and mock mode without changing feature code.
