## Functions

- `RootLayout` in `app/layout.tsx` applies Inter font, metadata, and wraps all routes into `AppShell`.
- `AppShell` in `components/layout/app-shell.tsx` composes `Sidebar`, `Header`, and `BottomNav`, maps route titles, and runs GSAP entry animations on navigation.
- `Sidebar` in `components/layout/sidebar.tsx` renders desktop navigation with active-state highlighting and collapse/expand behavior.
- `BottomNav` in `components/layout/bottom-nav.tsx` renders fixed mobile navigation with icon + label tabs.
- `Header` in `components/layout/header.tsx` displays the current page title and action slot with `NotificationBell`.
- `NotificationBell` in `components/layout/notification-bell.tsx` polls `/api/v1/reminders/pending` every 60 seconds and renders a dropdown with pending reminders.

## Types

- `NavigationItem` in `components/layout/navigation-config.ts` defines typed navigation records (route, label, icon component).
- `ReminderItem` and `PendingRemindersResponse` in `components/layout/notification-bell.tsx` define reminder payload structures for polling UI.
- `pageTitles` in `components/layout/navigation-config.ts` centralizes route-to-title mapping used by the header.

## Data Flow

1. Every route is wrapped by `RootLayout` and rendered inside `AppShell`.
2. `AppShell` reads pathname from App Router and passes mapped title to `Header`.
3. `Sidebar` and `BottomNav` reuse `navigationItems` config and compute active items by current pathname.
4. `NotificationBell` fetches pending reminders via `apiClient.get` and refreshes data on a 60-second interval.
5. Route pages (`/`, `/schedule`, `/homework`, `/reminders`, `/analytics`, `/materials`) render section-level content inside the shared shell container.

## Notes

- `next.config.ts` enables `experimental.turbopackUseSystemTlsCerts` to avoid Google Fonts TLS issues in this environment.
- `next.config.ts` also sets `allowedDevOrigins` for `127.0.0.1` used by browser-based integration checks.
- Primary and accent color tokens in `app/globals.css` are shifted to brighter values to match the school-themed UI direction.
- `@tabler/icons-react` is used for all navigation/action icons to align with project icon rules.
- `apiClient.request<T>(endpoint, options)` in `lib/api-client.ts` executes HTTP requests against `NEXT_PUBLIC_API_URL`, normalizes request body/headers, and throws typed API errors.
- `apiClient.get<T>()` and `apiClient.post<T>()` in `lib/api-client.ts` provide typed convenience wrappers.
- `useAppStore` in `store/use-app-store.ts` stores a basic readiness flag for initial Zustand wiring.
- `useScheduleStore` in `store/schedule.ts` loads subjects and lesson slots, handles CRUD for subjects/slots, and tracks loading/error/day selection states.
- `SchedulePageClient` in `components/schedule/schedule-page-client.tsx` coordinates schedule data fetching and modal orchestration for slot/subject management.
- `ScheduleGrid` in `components/schedule/schedule-grid.tsx` renders adaptive schedule views (mobile day tabs + desktop weekday columns).
- `ScheduleForm` in `components/schedule/schedule-form.tsx` validates and submits lesson slots with overlap and time-order checks.
- `SubjectManager` in `components/schedule/subject-manager.tsx` provides subject CRUD UI with color selection.
- `ScheduleSlotCard` in `components/schedule/schedule-slot-card.tsx` displays a lesson slot with subject color marker and edit/delete actions.

## Types

- `ApiRequestOptions` in `types/api.ts` supports generic request bodies for JSON and form payloads.
- `Subject`, `SubjectCreate`, `SubjectUpdate`, `ScheduleSlot`, `ScheduleSlotCreate`, and `ScheduleSlotUpdate` in `types/schedule.ts` define the scheduling domain model.
- `ScheduleStore` in `store/schedule.ts` defines the Zustand contract used by the schedule page.

## Data Flow

1. `app/schedule/page.tsx` renders `SchedulePageClient` as the `/schedule` entry point.
2. On mount, `SchedulePageClient` calls `fetchSubjects()` and `fetchSchedule()` from `useScheduleStore`.
3. `ScheduleGrid` receives subjects/slots from the store and renders either mobile tabs or desktop weekday columns.
4. `ScheduleForm` and `SubjectManager` submit CRUD actions through `useScheduleStore`, which syncs changes back from API endpoints.
5. `ScheduleSlotCard` resolves subject metadata by `subject_id` and exposes edit/delete callbacks.

## Notes

- New schedule API paths are centralized in `store/schedule.ts` as `/subjects` and `/schedule/slots`.
- Subject color rendering uses a constrained palette from `components/schedule/constants.ts` to avoid inline style usage.
- `/schedule` is statically generated by Next.js and becomes interactive client-side through Zustand state.
- `RemindersPage` in `app/reminders/page.tsx` mounts `RemindersPageClient` as the interactive `/reminders` entry point.
- `RemindersPageClient` in `components/reminders/reminders-page-client.tsx` loads reminders/homework from Zustand, maps reminder cards with homework metadata, and coordinates add/edit/delete modal flows.
- `ReminderList` in `components/reminders/reminder-list.tsx` renders grouped reminders by time horizon (`Сегодня`, `Завтра`, `На этой неделе`, `Позднее`).
- `ReminderCard` in `components/reminders/reminder-card.tsx` displays reminder content, status badge (`pending`/`sent`), subject marker, and edit/delete actions.
- `ReminderEditModal` in `components/reminders/reminder-edit-modal.tsx` provides create/update form with datetime validation for future-only reminders.
- `groupReminders`, `sortByClosest`, and `isFutureDate` in `components/reminders/reminder-utils.ts` implement ordering, bucket grouping, and validation helpers used by UI + tests.
- `useReminderStore` in `store/reminders.ts` handles API-backed CRUD operations for reminders and homework options.

## Types

- `ReminderStatus`, `Homework`, `Reminder`, `ReminderCreate`, `ReminderUpdate`, and `ReminderView` in `types/reminders.ts` define the reminders domain and UI projection shape.
- `ReminderStore` in `store/reminders.ts` defines the Zustand contract for loading state, error state, and reminder/homework mutations.
- `ReminderGroup` in `components/reminders/reminder-utils.ts` types grouped reminder sections.

## Data Flow

1. `RemindersPageClient` loads `fetchReminders()` and `fetchHomework()` on mount.
2. Zustand store requests `/api/v1/reminders` and `/api/v1/homework`, then exposes state to UI selectors.
3. Client maps reminders to `ReminderView`, enriches with homework metadata, then sorts/group by helper utilities.
4. `ReminderEditModal` validates datetime and dispatches `addReminder`/`updateReminder`; `ReminderCard` delete action dispatches `deleteReminder`.
5. Store re-fetches reminder list after every mutation to keep UI synchronized with backend state.

## Notes

- Unit/component tests for reminders are implemented with Vitest + Testing Library in `components/reminders/__tests__` and `store/__tests__/reminders.test.ts`.
- Playwright integration coverage for `/reminders` lives in `tests/reminders.spec.ts`; browser execution in this container may require additional system libraries.
- `HomeworkPage` in `app/homework/page.tsx` mounts `HomeworkPageClient` for the `/homework` route.
- `HomeworkPageClient` in `components/homework/homework-page-client.tsx` orchestrates loading homework/subjects, client-side filters, and modal flows for create/edit/mood actions.
- `HomeworkFilters` in `components/homework/homework-filters.tsx` exposes subject/status/deadline selectors and emits normalized filter state.
- `HomeworkList` in `components/homework/homework-list.tsx` renders responsive homework cards and applies GSAP enter animation for card changes.
- `HomeworkCard` in `components/homework/homework-card.tsx` shows subject tag, completion state, overdue highlight, and actions for edit/delete/complexity rating.
- `HomeworkEditModal` in `components/homework/homework-edit-modal.tsx` validates title/deadline and handles add/update payload submission.
- `MoodPicker` in `components/homework/mood-picker.tsx` submits difficulty (`easy`/`normal`/`hard`) with optional note.
- `filterHomework`, `sortByDeadline`, `getStepsProgress`, and `isPastDeadline` in `components/homework/homework-utils.ts` provide filtering/sorting/progress and overdue helpers.
- `useHomeworkStore` in `store/homework.ts` integrates `/api/v1/homework`, `/api/v1/subjects`, and `/api/v1/mood` endpoints through Zustand actions.

## Types

- `Homework`, `HomeworkCreate`, `HomeworkUpdate`, `HomeworkFiltersState`, `Subject`, and `MoodLevel` in `types/homework.ts` define homework domain + filter contracts.
- `HomeworkStore` in `store/homework.ts` defines Zustand state/actions for CRUD, completion toggle, and mood submission.

## Data Flow

1. `/homework` renders `HomeworkPageClient`, which fetches homework and subject dictionaries on mount.
2. Store actions call API endpoints and refresh homework list after create/update/delete/toggle mutations.
3. `HomeworkFilters` updates local filter state; `filterHomework` + `sortByDeadline` derive visible cards.
4. `HomeworkEditModal` and `MoodPicker` submit payloads through store actions and close on success.
5. `HomeworkList` resolves subject metadata per card and animates card set changes with GSAP.

## Notes

- Unit/component TDD coverage for homework is implemented in `store/__tests__/homework.test.ts`, `components/homework/__tests__/homework-edit-modal.test.tsx`, and `components/homework/__tests__/homework-filters.test.tsx`.
- Playwright smoke scenario for `/homework` lives in `tests/homework.spec.ts`.

## Notes (Update: modal overlay + mock API)

- `components/common/modal-overlay.tsx` introduces a shared portal-based modal wrapper with body scroll lock, Escape close handling, focus-first behavior, and GSAP open/close transitions.
- `HomeworkEditModal`, `ReminderEditModal`, `MoodPicker`, `ScheduleForm`, and `SubjectManager` now render modal content through `ModalOverlay`, so dimming covers the full viewport beyond `AppShell` rounded containers.
- `components/layout/app-shell.tsx` uses `min-h-dvh`, and `components/layout/bottom-nav.tsx` raises mobile nav stacking to `z-50` for improved visibility during mobile browser viewport changes.
- `components/schedule/schedule-page-client.tsx` and `components/schedule/schedule-grid.tsx` apply tighter mobile spacing, responsive headline sizing, and a 5-column day selector grid for compact screens.
- `lib/mock-data.ts`, `lib/mock-api-routes.ts`, and `lib/mock-api-client.ts` provide in-memory mock payloads and CRUD behavior for subjects, schedule, homework, reminders, analytics, and pending reminder polling.
- `lib/api-client.ts` exports `api`, switching between `apiClient` and `mockApiClient` via `NEXT_PUBLIC_USE_MOCK`.
- `store/schedule.ts`, `store/homework.ts`, `store/reminders.ts`, `store/analytics.ts`, and `components/layout/notification-bell.tsx` consume `api` to support both live backend and mock mode without changing feature code.

## Notes (2026-02-17 frontend fixes)

- Added `uiText` dictionary in `lib/i18n.ts` to centralize RU labels for common UI text and reminder statuses/group titles.
- `groupReminders` now supports an additional `overdue` bucket and keeps ordering `Просрочено → Сегодня → Завтра → На этой неделе → Позднее`.
- Reminder cards now use localized status labels, fallback `Без предмета`, and wrapped actions so mobile destructive action does not overflow card bounds.
- Schedule desktop grid now renders without forced horizontal scrolling (`min-w-[980px]` removed), while mobile day tabs support overflow with non-breaking labels.
- Schedule slot deletion now asks for explicit confirmation and uses lower-emphasis destructive action style.
- Dashboard cards were visually rebalanced: “Фокус дня” and “Быстрые действия” are now closer in visual weight, and quick actions include Tabler icons.
- Homework card action hierarchy updated (`Оценить сложность` moved to ghost style), completion indicator simplified to a single checkbox mode.
- Homework filters now keep equal full-width controls and shift to a balanced two-row layout on smaller screens.
- Analytics warnings received tone-based styling (`warning`/`danger`/`info`) to reduce always-red emphasis.

## Notes (2026-02-18 materials search)

## Functions

- `MaterialsPage` in `app/materials/page.tsx` now delegates route rendering to the client container `MaterialsPageClient`.
- `MaterialsPageClient` in `components/materials/materials-page-client.tsx` binds `useMaterialStore` actions/state to UI blocks (`MaterialSearch`, `MaterialList`) and displays loading/error search feedback.
- `MaterialSearch` in `components/materials/material-search.tsx` manages query/subject inputs, triggers debounced search after 300ms, and supports immediate search via the `Найти` button.
- `MaterialList` in `components/materials/material-list.tsx` renders a responsive cards grid or empty-state placeholder.
- `MaterialCard` in `components/materials/material-card.tsx` visualizes source type (YouTube/Article) with Tabler icons, optional thumbnail, and an external open link.
- `useMaterialStore` in `store/materials.ts` implements `/api/v1/materials/search` and `/api/v1/homework/{id}/materials` integration with loading/error state handling.

## Types

- `MaterialSource` and `Material` in `types/materials.ts` define source discriminator and material data contract used across store/UI/tests.
- `MaterialStore` in `store/materials.ts` defines state/actions for manual topic search and homework materials fetch.

## Data Flow

1. `/materials` route renders `MaterialsPageClient`.
2. User enters search text/subject in `MaterialSearch`.
3. `MaterialSearch` invokes `searchMaterials(query, subject)` from Zustand after debounce (or button click).
4. `useMaterialStore` performs GET request to `/api/v1/materials/search?query=&subject=` and updates `materials`, `loading`, `error`.
5. `MaterialList` maps `materials` to `MaterialCard` or renders `Ничего не найдено` when result is empty.

## Notes

- TDD coverage added for materials store and UI components in `store/__tests__/materials.test.ts`, `components/materials/__tests__/material-search.test.tsx`, and `components/materials/__tests__/material-list.test.tsx`.
- Playwright smoke coverage for `/materials` search flow added in `tests/materials.spec.ts` (requires Playwright browser binaries in environment).

## Notes (2026-02-18 Playwright integration coverage)

- Added full Playwright integration matrix in `tests/` for all primary pages: dashboard (`dashboard.spec.ts`), schedule (`schedule.spec.ts`), homework (`homework.spec.ts`), reminders (`reminders.spec.ts`), analytics (`analytics.spec.ts`), materials (`materials.spec.ts`), global navigation (`navigation.spec.ts`), and notification dropdown (`notification-bell.spec.ts`).
- New schedule coverage validates page render, slot creation/deletion, and subject management CRUD with mocked `/subjects` and `/schedule/slots` API calls.
- Homework coverage now includes create, completion toggle (`PATCH /api/v1/homework/:id/complete`), deletion, modal validation, and mood submission (`POST /api/v1/mood`).
- Reminders coverage now includes create and deletion flows in addition to initial grouped render state.
- Analytics coverage now validates normal render, empty data state, and API failure rendering path.
- All Playwright scenarios rely on `page.route()` API mocking and do not require a running backend service.

## Notes (2026-02-18 dashboard integration + shell fixes)

## Functions

- `ModalOverlay` in `components/common/modal-overlay.tsx` now keeps an internal `visible` state to preserve DOM during close animation and unmounts only after GSAP fade/scale-out completion.
- `AppShell`, `Sidebar`, `Header`, and `NotificationBell` in `components/layout/*` were adjusted for stacking/scroll behavior: sticky desktop sidebar, elevated header layer, and raised bell container z-index.
- `HomePage` in `app/page.tsx` now renders `DashboardPageClient`, moving dashboard interactivity into a client component.
- `DashboardPageClient` in `components/dashboard/dashboard-page-client.tsx` fetches dashboard summary on mount and renders loading/error-aware KPI cards.
- `useDashboardStore` in `store/dashboard.ts` aggregates homework, schedule, subjects, and warnings endpoints into a single `DashboardSummary` state.

## Types

- `DashboardSummary` in `types/dashboard.ts` defines typed aggregates for nearest homework, today's lessons, and warnings card content.

## Data Flow

1. `/` route renders server component `HomePage`, which mounts `DashboardPageClient`.
2. On mount, `DashboardPageClient` calls `fetchDashboard()` from Zustand store.
3. `useDashboardStore` executes four parallel API calls (`/api/v1/homework`, `/schedule/slots`, `/api/v1/subjects`, `/api/v1/analytics/warnings`).
4. Store derives nearest incomplete homework, today's lessons list/count, and warnings summary, then updates UI cards.
5. `ModalOverlay` close transitions keep portal visible until animation completes, preserving smooth UX for all modal consumers.

## Notes

- Dashboard keeps quick actions and hero section static while backend-driven metrics update asynchronously.
- Playwright dashboard spec now mocks newly used dashboard endpoints in addition to reminder polling.

## Notes (2026-02-18 smart homework steps)

## Functions

- `useHomeworkStore` в `store/homework.ts` получил действия `generateSteps(homeworkId)` и `toggleStep(stepId)` плюс состояние `isGeneratingByHomeworkId` для per-card loading.
- `HomeworkCard` в `components/homework/homework-card.tsx` получил кнопку `Сгенерировать шаги`, loader-состояние и чеклист шагов с переключением.
- `HomeworkList` и `HomeworkPageClient` прокидывают новые обработчики генерации/переключения шагов до карточек.

## Types

- `HomeworkStep` в `types/homework.ts` использует backend-поля `order` и `is_completed`.
- Добавлен `GenerateStepsResponse` для ответа `POST /api/v1/homework/{id}/generate-steps`.

## Data Flow

1. Пользователь нажимает `Сгенерировать шаги` в карточке ДЗ.
2. Store вызывает `POST /api/v1/homework/{id}/generate-steps`, показывает loader конкретной карточки, затем обновляет список ДЗ.
3. Пользователь отмечает шаг в чеклисте.
4. Store вызывает `PATCH /api/v1/homework/steps/{step_id}/toggle` и перезапрашивает список ДЗ.

## Notes

- Для локального mock режима добавлены обработчики `generate-steps` и `toggle-step` в `lib/mock-api-routes.ts`.

## Notes (2026-02-18 ai materials recommendation)

## Functions

- `useMaterialStore` в `store/materials.ts` хранит `recommendation` и обрабатывает новый backend-контракт `AIMaterialsResponse` для ручного поиска и материалов по ДЗ.
- `MaterialsPageClient` в `components/materials/materials-page-client.tsx` отображает блок `AI-рекомендация` при непустом поле `recommendation`.
- `MaterialCard` в `components/materials/material-card.tsx` показывает `description` и поддерживает source `website` с иконкой `IconWorld`.

## Types

- `AIMaterialsResponse` добавлен в `types/materials.ts`.
- `Material` расширен полем `description`, а `MaterialSource` — значением `website`.

## Data Flow

1. Поиск материалов получает ответ `AIMaterialsResponse` с `materials[]` и `recommendation`.
2. Zustand store сохраняет материалы и AI-рекомендацию в единый state.
3. Страница материалов рендерит рекомендацию над списком карточек.

## Notes

- Тесты обновлены для store и компонентов материалов под новый контракт ответа.

## Notes (2026-02-18 frontend ux/api fixes)

## Functions

- `DashboardPageClient` в `components/dashboard/dashboard-page-client.tsx` получил интерактивные быстрые действия с `router.push()` и focus/hover-состояниями для клавиатурной и мышиной навигации.
- `HomeworkCard`, `HomeworkList` и `HomeworkPageClient` в `components/homework/*` объединяют сценарий завершения ДЗ в кнопку `Сделано`: открывается `MoodPicker`, после отправки оценки выполняется удаление задания.
- `ScheduleGrid` в `components/schedule/schedule-grid.tsx` использует десктопный горизонтальный контейнер с фиксированной шириной колонок дней и минимальной высотой карточек.
- `apiClient` и `mockApiClient` в `lib/api-client.ts` и `lib/mock-api-client.ts` получили унифицированные методы `put`, `patch`, `delete`.

## Types

- Элементы `SUBJECT_COLORS` в `components/schedule/constants.ts` расширены полем `label` для русских названий цветов при сохранении `value` для API-совместимости.

## Data Flow

1. Быстрые действия на `/` теперь ведут пользователя напрямую на `/homework`, `/reminders`, `/analytics`.
2. На `/homework` пользователь нажимает `Сделано` → `MoodPicker` отправляет `POST /api/v1/mood` → затем удаление через `DELETE /api/v1/homework/{id}` и рефетч списка.
3. Сторы расписания и дашборда используют backend-префикс `/api/v1` для предметов и слотов, исключая 404 при отключённом mock.
4. `resolveMockRequest` поддерживает новые `/api/v1/subjects` и `/api/v1/schedule/slots` (и legacy пути для обратной совместимости).

## Notes

- Палитра предметов расширена до 14 цветов с русскими подписями в UI менеджера предметов.
- В `components/layout/header.tsx` удалён неиспользуемый импорт `IconMenu2` для чистого lint-статуса.

## Notes (2026-02-18 api audit alignment)

## Functions

- `useScheduleStore` и `useDashboardStore` обновили endpoint расписания до `/api/v1/schedule` и больше не используют legacy `/schedule/slots`.
- `useHomeworkStore.makeQuery` теперь строит backend-совместимые фильтры `subject_id`, `is_completed`, `deadline_from`, `deadline_to`.
- `useAnalyticsStore` и `useDashboardStore` читают предупреждения из объекта `{ warnings: string[] }`.
- `WarningsList`, `WeekLoadChart`, `MoodStatsCard` приведены к backend-формату аналитики и сохраняют совместимость с legacy тестовыми структурами.
- `useMaterialStore` отправляет `subject_id` при поиске и использует материал без обязательного `id`.

## Types

- `ScheduleSlot`/`ScheduleSlotCreate` используют поле `room`.
- `Homework`/`HomeworkUpdate` используют `is_completed`.
- `Reminder` использует `is_sent`, а `ReminderUpdate` ограничен полем `remind_at`.
- Аналитические типы обновлены: `WeekLoadDay` -> `load_score`/`lessons_count`/`hard_subjects`/`warning`, `MoodStats` -> `*_count`, `WarningsResponse` -> объект с массивом строк.
- `Material` использует `thumbnail_url` и не требует `id`.

## Data Flow

1. Schedule CRUD/store и dashboard summary ходят в `/api/v1/schedule` с payload полем `room`.
2. Homework list фильтрация на API полностью совпадает с Query-параметрами backend и возвращает `is_completed` для UI-фильтрации.
3. Reminders UI хранит статус через `is_sent`; при редактировании отправляется только `remind_at`.
4. Analytics UI получает недельную нагрузку, mood stats и warnings в backend-формате без клиентского рассинхрона полей.
5. Materials search отправляет `subject_id`, карточки используют `thumbnail_url`, key формируется от `url+title`.

## Notes

- Mock-слой (`mock-data`/`mock-api-routes`) синхронизирован с backend-контрактами и поддерживает новые query-параметры ДЗ и форматы аналитики.
- Обновлены store/component тесты под новые API-контракты без изменения бизнес-сценариев.

## Notes (2026-02-18 schedule/reminders/header fixes)

## Functions

- `ScheduleForm` now supports `onDeleteSubject` and renders a destructive "Удалить предмет" action in lesson edit mode with confirm dialog.
- `RemindersPageClient` now renders reminders directly from backend response (`reminder.homework`) and no longer rebuilds a merged list from homework store data.
- `ReminderEditModal` now uses separate `date` and `time` inputs and composes ISO datetime on submit.
- `Header` increased stacking order (`z-40`) so `NotificationBell` dropdown is not hidden by content container.

## Types

- `types/reminders.ts` now matches backend payloads: `Reminder` includes nested `homework`, `is_sent`, `created_at`, and `updated_at`.
- `ReminderUpdate` remains limited to `remind_at` only.

## Data Flow

- Reminder create/update modal submits ISO UTC timestamps derived from separate date/time values.
- Reminder cards read subject metadata from `reminder.homework.subject.{name,color}`.
